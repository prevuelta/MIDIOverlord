//
//  global.m
//  MIDIOverlord
//
//  Created by Pablo Revuelta on 13/06/14.
//  Copyright (c) 2014 Midnight City. All rights reserved.
//

#import "global.h"

static global *_instance;

@implementation global

@synthesize midiDestinations = _midiDestinations;

+(global*)sharedGlobalData {
    
    @synchronized(self) {
        if (_instance == nil) {
            _instance = [[self alloc] init];
            
            _instance.patternBg = [NSImage imageNamed: @"patternBg.gif"];
            
            NSDictionary *RGBAColorValues = @{
                @"black" : @[@0, @0, @0, @255],
                @"darkestGrey" : @[@16, @16, @16, @255],
                @"darkerGrey" : @[@32, @32, @32, @255],
                @"darkGrey" : @[@48, @48, @48, @255],
                @"grey" : @[@68, @68, @68, @255],
                @"lightGrey" : @[@160, @160, @160, @255],
                @"lighterGrey" : @[@234, @234, @234, @255],
                @"lightestGrey" : @[@244, @244, @244, @255],
                @"white" : @[@255, @255, @255, @255],
                @"darkBrown" : @[@57, @47, @38, @255],
                @"brown" :  @[@149, @149, @122, @255],
                @"lighterBrown" : @[@224, @224, @201, @255],
                @"lightestBrown" : @[@245, @244, @233, @255],
                @"red" : @[@232, @65, @56, @255],
                
                @"darkBlue" : @[@23, @143, @193, @255],
                @"blue" : @[@0, @169, @232, @255],
                @"paleBlue" : @[@226, @244, @249, @255],
                @"darkPaleBlue" : @[@136, @210, @231, @255],
                
                @"purple" : @[@193, @23, @192, @255],
                @"pink" : @[@226, @87, @242, @255],
                
                @"yellow" : @[@243, @230, @30, @255]
            };
            
            _instance.colors = [NSMutableDictionary new];
            
            for(NSString *key in RGBAColorValues) {
                NSArray *RGBAArray = [RGBAColorValues objectForKey: key];
                NSColor *color = [utilities getNSColorFromRGBAArray: RGBAArray];
                [_instance.colors setObject:color forKey: key];
            }
            
            float blackRGBA[] = MO_BLACK;
            float darkestGreyRGBA[] = MO_DARKEST_GREY;
            float darkBrownRGBA[] = MO_DARK_BROWN;
            float brownRGBA[] = MO_BROWN;
            
            float defaultRGBA[] = UI_COLOR_PROT_1;
            float bgRGBA[] = MO_BROWN_WHITE;
            float markerRGBA[] = MO_BLUE;
            float activeRGBA[] = MO_RED;
            
           _instance.black = [utilities getNSColorFromRGB:blackRGBA];
            _instance.darkestGrey = [utilities getNSColorFromRGB:darkestGreyRGBA];
            _instance.darkBrown = [utilities getNSColorFromRGB:darkBrownRGBA];
            _instance.brown = [utilities getNSColorFromRGB:brownRGBA];
            
           _instance.defaultColor = [utilities getNSColorFromRGB:defaultRGBA];
           _instance.bgColor = [utilities getNSColorFromRGB:bgRGBA];
           _instance.markerColor = [utilities getNSColorFromRGB:markerRGBA];
           _instance.activeColor = [utilities getNSColorFromRGB:activeRGBA];
            
            NSMutableCharacterSet *allowedCharacters = [NSMutableCharacterSet new];
            
            [allowedCharacters addCharactersInString: @"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 _!@#$%^&*()-=_+[]\\{}|,./<>?:\"';"];
            
            _instance.invalidChars = [allowedCharacters invertedSet];
            
            NSMutableCharacterSet *allowedNumbers = [NSMutableCharacterSet new];
            
            [allowedNumbers addCharactersInString: @"1234567890"];
            
            _instance.notNumbers = [allowedNumbers invertedSet];
            
            _instance.glyphs  = @{
                 // Uppercase
                 @"A" : @[@0, @42, @43, @49, @52, @46, @47, @5, @4, @22, @19, @25, @28, @46, @43, @1],
                 @"B" : @[@0, @4, @10, @11, @29, @28, @34, @35, @47, @46, @52, @49, @43, @46, @34, @33, @27, @28, @10, @7, @25, @27, @33, @31, @49, @48],
                 @"C" : @[@17, @11, @10, @4, @1, @7, @6, @42, @43, @49, @52, @46, @47, @41, @40, @46, @43, @7, @10, @16],
                 @"D" : @[@0, @48, @51, @45, @46, @40, @41, @17, @16, @10, @9, @3, @1, @7, @9, @15, @16, @40, @39, @45, @43, @1],
                 @"E" : @[@53, @48, @0, @5, @11, @7, @25, @28, @34, @31, @43, @47],
                 @"F" : @[@0, @1, @25, @28, @34, @31, @43, @47, @53, @48],
                 @"G" :@[@40, @46, @43, @7, @10, @22, @20, @26, @29, @11, @10, @4, @1, @7, @6, @42, @43, @49, @52, @46, @47, @41],
                 @"H" : @[@48, @0, @1, @25, @28, @4, @5, @53, @52, @34, @31, @49],
                 @"I" : @[@0, @5, @11, @9, @45, @47, @53, @48, @42, @44, @8, @6],
                 @"J" : @[@49, @43, @46, @10, @6, @0, @4, @10, @11, @53],
                 @"K" : @[@52, @40, @39, @33, @31, @49, @48, @0, @1, @25, @27, @21, @22, @4, @5, @23, @22, @28, @27, @33, @34, @40, @41, @53],
                 @"L" : @[@48, @0, @5, @11, @7, @49],
                 @"M" : @[@0, @48, @49, @43, @44, @38, @39, @45, @46, @52, @53, @5, @4, @46, @40, @39, @33, @32, @38, @37, @1],
                 @"N" : @[@0, @48, @49, @43, @44, @38, @39, @33, @34, @52, @53, @5, @4, @28, @27, @33, @32, @38, @37, @1],
                 @"O" : @[@42, @6, @7, @1, @4, @10, @11, @47, @46, @52, @49, @43, @46, @10, @7, @43],
                 @"P" : @[@0, @48, @53, @29, @25, @31, @34, @46, @43, @1],
                 @"Q" : @[@48, @0, @4, @16, @15, @21, @20, @14, @15, @9, @7, @43, @46, @4, @5, @53],
                 @"R" : @[@0, @1, @19, @21, @15, @16, @4, @5, @17, @16, @28, @29, @47, @46, @52, @49, @43, @46, @28, @25, @49, @48],
                 @"S" : @[@1, @4, @10, @11, @29, @28, @34, @31, @43, @46, @40, @41, @47, @46, @52, @49, @43, @42, @30, @31, @25, @28, @10, @7, @13, @12, @6],
                 @"T" : @[@2, @44, @42, @48, @53, @47, @45, @3],
                 @"U" : @[@48, @0, @5, @53, @52, @10, @7, @49],
                 @"V" : @[@2, @8, @7, @13, @12, @48, @49, @13, @14, @8, @9, @15, @16, @52, @53, @17, @16, @10, @9, @3],
                 @"W" : @[@48, @0, @1, @7, @8, @14, @15, @9, @10, @4, @5, @53, @52, @16, @15, @21, @20, @14, @13, @49],
                 @"X" : @[@0, @12, @13, @19, @20, @26, @25, @31, @30, @48, @49, @31, @32, @26, @27, @33, @34, @52, @53, @35, @34, @28, @27, @21, @22, @16, @17, @5, @4, @16, @15, @21, @20, @14, @13, @1],
                 @"Y" : @[@48, @18, @20, @2, @3, @21, @23, @53, @52, @28, @25, @49],
                 @"Z" : @[@48, @53, @47, @46, @34, @33, @21, @20, @8, @11, @5, @0, @6, @7, @19, @20, @32, @33, @45, @42],
                 // Lowercase
                 
                 @"a" : @[@5, @1, @7, @6, @12, @13, @19, @22, @16, @13, @7, @10, @28, @25, @31, @34, @28, @29, @5],
                 @"b" : @[@48, @0, @4, @10, @11, @29, @28, @34, @32, @26, @25, @19, @20, @26, @28, @10, @7, @49],
                 @"c" : @[@17, @16, @10, @7, @25, @28, @22, @23, @29, @28, @34, @31, @25, @24, @6, @7, @1, @4, @10, @11],
                 @"d" : @[@53, @5, @1, @7, @6, @24, @25, @31, @33, @27, @28, @22, @21, @27, @25, @13, @7, @10, @52],
                 @"e" : @[@4, @1, @7, @6, @24, @25, @31, @34, @28, @29, @17, @13, @19, @22, @28, @25, @7, @10],
                 @"f" : @[@2, @26, @24, @30, @32, @50, @53, @47, @45, @33, @35, @29, @27, @3],
                 @"g" : @[@35, @30, @12, @16, @10, @6, @0, @5, @29, @28, @22, @19, @25, @29],
                 @"h" : @[@48, @0, @1, @19, @20, @26, @28, @4, @5, @29, @28, @34, @32, @26, @25, @49],
                 @"i" : @[@1, @4, @10, @9, @33, @31, @25, @26, @8, @7, @44, @45, @39, @38],
                 @"j" : @[@40, @34, @35, @41, @40, @28, @29, @11, @10, @4, @0, @6, @10, @28],
                 @"k" : @[@48, @0, @1, @13, @16, @4, @5, @17, @16, @22, @23, @35, @31, @25, @28, @22, @19, @49],
                 @"l" : @[@49, @43, @44, @2, @4, @10, @9, @51],
                 @"m" : @[@0, @30, @35, @5, @4, @28, @27, @15, @14, @26, @25, @1],
                 @"n" : @[@0, @30, @35, @5, @4, @28, @25, @1],
                 @"o" : @[@35, @30, @0, @5, @29, @28, @10, @7, @25, @29],
                 @"p" : @[@0, @30, @35, @17, @13, @19, @22, @28, @25, @1],
                 @"q" : @[@30, @12, @16, @22, @19, @25, @28, @4, @5, @35],
                 @"r" : @[@0, @30, @35, @29, @25, @1],
                 @"s" : @[@35, @30, @12, @16, @10, @6, @0, @5, @23, @19, @25, @29],
                 @"t" : @[@50, @32, @30, @24, @26, @2, @5, @11, @9, @27, @29, @35, @33, @51],
                 @"u" : @[@30, @0, @5, @35, @34, @10, @7, @31],
                 @"v" : @[@30, @12, @13, @7, @8, @2, @3, @9, @10, @16, @17, @35, @34, @16, @15, @9, @8, @14, @13, @31],
                 @"w" : @[@30, @0, @5, @35, @34, @10, @9, @21, @20, @8, @7, @31],
                 @"x" : @[@30, @31, @25, @26, @20, @21, @27, @28, @34, @35, @29, @28, @22, @21, @15, @16, @10, @11, @5, @4, @10, @9, @15, @14, @8, @7, @1, @0, @6, @7, @13, @14, @20, @19, @25, @24],
                 @"y" : @[@30, @12, @16, @10, @6, @0, @5, @35, @34, @22, @19, @31],
                 @"z" : @[@30, @35, @29, @28, @22, @21, @15, @14, @8, @11, @5, @0, @6, @7, @13, @14, @20, @21, @27, @24],
                 
                 // Puncuation
                 @"_" : @[@6, @11, @5, @0],
                 @"!" : @[@51, @21, @20, @50, @51, @8, @9, @3, @2, @8],
                 @"@" : @[@26, @14, @17, @35, @34, @40, @37, @31, @30, @6, @7, @1, @5, @11, @7, @31, @34, @22, @21, @27, @26],
                 @"#" : @[@1, @7, @6, @12, @13, @25, @24, @30, @31, @37, @38, @32, @33, @39, @40, @34, @35, @29, @28, @16, @17, @11, @10, @4, @3, @9, @8, @14, @15, @27, @26, @2],
                 @"$" : @[@2, @8, @7, @13, @12, @18, @19, @13, @14, @26, @25, @31, @30, @36, @37, @43, @44, @50, @51, @45, @46, @40, @41, @35, @34, @40, @37, @31, @32, @38, @39, @27, @28, @22, @23, @17, @16, @10, @9, @15, @16, @22, @21, @3],
                 @"%" :@[@6, @12, @13, @19, @20, @26, @32, @31, @37, @38, @26, @27, @33, @34, @40, @41, @35, @34, @28, @27, @15, @16, @10, @9, @21, @20, @14, @13, @7, @6],
                 @"^" : @[@50, @44, @43, @37, @38, @44, @45, @39, @40, @46, @45, @51],
                 @"&" : @[@5, @4, @10, @9, @3, @1, @7, @6, @18, @19, @25, @24, @36, @37, @43, @45, @39, @40, @34, @33, @39, @37, @25, @26, @20, @21, @15, @14, @20, @19, @7, @9, @15, @16, @22, @23, @17, @16, @10, @11],
                 @"*" : @[@36, @37, @31, @32, @44, @45, @33, @34, @40, @41, @35, @34, @28, @29, @23, @22, @28, @27, @15, @14, @26, @25, @19, @18, @24, @25, @31, @30],
                 @"(" : @[@52, @51, @45, @44, @38, @37, @13, @14, @8, @9, @3, @4, @10, @9, @15, @14, @38, @39, @45, @46, @52],
                 @")" : @[@49, @43, @44, @38, @39, @15, @14, @8, @7, @1, @2, @8, @9, @15, @16, @40, @39, @45, @44, @50],
                 @"-" : @[@29, @24, @18, @23],
                 @"=" : @[@17, @12, @18, @23, @17, @29, @24, @30, @35, @29],
                 @"+" : @[@38, @26, @24, @18, @20, @8, @9, @21, @23, @29, @27, @39],
                 @"[" : @[@52, @49, @1, @4, @10, @8, @44, @46],
                 @"]" : @[@49, @52, @4, @1, @7, @9, @45, @43],
                 @"{" : @[@51, @50, @44, @43, @31, @30, @24, @25, @7, @8, @2, @3, @9, @8, @26, @25, @31, @32, @44, @45],
                 @"}" : @[@35, @34, @46, @45, @51, @50, @44, @45, @33, @34, @28, @27, @9, @8, @2, @3, @9, @10, @28, @29],
                 //        @"|" : @[@50, @2, @3, @51],
                 @"," : @[@13, @7, @8, @2, @3, @15],
                 @"." : @[@1, @7, @8, @2],
                 @"/" : @[@0, @12, @13, @25, @26, @38, @39, @51, @52, @40, @39, @27, @26, @14, @13, @1],
                 @"<" : @[@53, @52, @46, @45, @39, @38, @32, @31, @19, @20, @14, @15, @9, @10, @4, @5, @11, @10, @16, @15, @21, @20, @32, @33, @40, @46, @47],
                 @">" : @[@48, @42, @43, @37, @38, @32, @33, @27, @21, @20, @14, @13, @7, @6, @0, @1, @7, @8, @14, @15, @21, @22, @28, @34, @33, @39, @38, @44, @43, @49],
                 @"?" : @[@8, @2, @3, @9, @8, @14, @26, @27, @33, @34, @46, @43, @37, @36, @42, @43, @49, @52, @46, @47, @35, @34, @28, @27, @15, @14],
                 @":" :  @[@38, @32, @33, @39, @38, @14, @8, @9, @15, @14],
                 @"\"" : @[@5, @17, @16, @28, @27, @39, @38, @50, @49, @37, @38, @26, @27, @15, @16, @4],
                 @"'" : @[@50, @44, @45, @39, @40, @52, @50],
                 @";" : @[@14, @8, @9, @3, @4, @16, @14, @32, @26, @27, @33],
                 
                 // Icons
                 @"|" :@[@0, @2, @8, @9, @39, @40, @34, @35, @41, @40, @46, @45, @51, @50, @20, @19, @13, @12], // Musical note
                 
                 // Numerals
                 @"0" : @[@49, @52, @46, @47, @11, @10, @4, @1, @7, @6, @42, @43, @7, @10, @46, @43],
                 @"1" : @[@0, @5, @11, @9, @51, @50, @44, @43, @37, @36, @30, @31, @37, @38, @8, @6],
                 @"2" : @[@36, @37, @43, @46, @34, @33, @27, @26, @20, @19, @13, @12, @0, @5, @11, @7, @13, @14, @20, @21, @27, @28, @34, @35, @47, @46, @52, @49, @43, @42],
                 @"3" : @[@48, @42, @46, @40, @39, @33, @32, @26, @28, @10, @7, @13, @12, @6, @7, @1, @4, @10, @11, @29, @28, @34, @40, @41, @53],
                 @"4" : @[@23, @22, @52, @51, @21, @19, @25, @26, @38, @39, @45, @44, @38, @37, @25, @24, @12, @15, @3, @4, @16, @17],
                 @"5" : @[@53, @48, @24, @28, @10, @7, @13, @12, @6, @7, @1, @4, @10, @11, @29, @28, @34, @31, @43, @47],
                 @"6" : @[@25, @24, @6, @7, @1, @4, @10, @11, @29, @28, @34, @31, @37, @38, @44, @46, @52, @50, @44, @43, @37, @36, @24, @28, @10, @7],
                 @"7" : @[@48, @53, @35, @34, @28, @27, @3, @2, @26, @27, @33, @34, @46, @42],
                 @"8" : @[@25, @24, @6, @7, @1, @4, @10, @11, @29, @28, @34, @31, @43, @46, @34, @35, @47, @46, @52, @49, @43, @42, @30, @31, @25, @28, @10, @7],
                 @"9" : @[@7, @1, @3, @9, @10, @16, @17, @29, @25, @43, @46, @28, @29, @47, @46, @52, @49, @43, @42, @24, @25, @19, @22, @16, @15, @9, @7]
                 };
            
        }
    }
    
    return _instance;
}

+(void)deselectNotify {
    [[NSNotificationCenter defaultCenter] postNotificationName:@"deselectAll" object:self userInfo: nil];
}


+(void)stopMappingNotify {
    [[NSNotificationCenter defaultCenter] postNotificationName:@"stopMapping" object:self userInfo: nil];
}

-(void)setMidiDestinations:(NSMutableDictionary *)midiDestinations{
    _midiDestinations = midiDestinations;
    [[NSNotificationCenter defaultCenter] postNotificationName:@"updateMidiDestinations" object:self userInfo: _midiDestinations];
}

-(NSMutableDictionary *)midiDestinations {
    return _midiDestinations;
}

+(NSString *)uuid {
    CFUUIDRef uuidRef = CFUUIDCreate(NULL);
    CFStringRef uuidStringRef = CFUUIDCreateString(NULL, uuidRef);
    CFRelease(uuidRef);
    return (__bridge NSString *)uuidStringRef;
}

+(int)getUnitWidth:(int)units {
    return UNIT_WIDTH * units;
}

+(int)getUnitHeight:(int)units {
    return UNIT_HEIGHT * units;
}

@end
